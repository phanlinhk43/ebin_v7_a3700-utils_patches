From bb8f82377341c5518e2669e20f1a1f1f663a9d8d Mon Sep 17 00:00:00 2001
From: Jason Hung <jhung@globalscaletechnologies.com>
Date: Thu, 24 May 2018 08:12:05 +0800
Subject: [PATCH 6/6] ddr: update ddr topology for ddr3/ddr4

update new ddr topology for ddr3/ddr4
---
 ddr/tim_ddr/DDR_TOPOLOGY_1.txt         |   3 +
 ddr/tim_ddr/DDR_TOPOLOGY_5.txt         |  25 ++++
 ddr/tim_ddr/DDR_TOPOLOGY_6.txt         |  25 ++++
 ddr/tim_ddr/DDR_TOPOLOGY_7.txt         |  23 ++++
 ddr/tim_ddr/DDR_TOPOLOGY_8.txt         |  25 ++++
 ddr/tim_ddr/ddr4-1cs-1g.txt            | 179 +++++++++++++++++++++++++++
 ddr/tim_ddr/ddr4-2cs-2g.txt            | 214 +++++++++++++++++++++++++++++++++
 ddr/tim_ddr/ddr4-800-1cs-512m-issi.txt | 179 +++++++++++++++++++++++++++
 ddr/tim_ddr/ddr4-800-2cs-1g-issi.txt   | 214 +++++++++++++++++++++++++++++++++
 script/buildtim.sh                     |   2 +-
 10 files changed, 888 insertions(+), 1 deletion(-)
 create mode 100644 ddr/tim_ddr/DDR_TOPOLOGY_5.txt
 create mode 100644 ddr/tim_ddr/DDR_TOPOLOGY_6.txt
 create mode 100644 ddr/tim_ddr/DDR_TOPOLOGY_7.txt
 create mode 100644 ddr/tim_ddr/DDR_TOPOLOGY_8.txt
 create mode 100644 ddr/tim_ddr/ddr4-1cs-1g.txt
 create mode 100644 ddr/tim_ddr/ddr4-2cs-2g.txt
 create mode 100644 ddr/tim_ddr/ddr4-800-1cs-512m-issi.txt
 create mode 100644 ddr/tim_ddr/ddr4-800-2cs-1g-issi.txt

diff --git a/ddr/tim_ddr/DDR_TOPOLOGY_1.txt b/ddr/tim_ddr/DDR_TOPOLOGY_1.txt
index d58da9d..44f2d7c 100644
--- a/ddr/tim_ddr/DDR_TOPOLOGY_1.txt
+++ b/ddr/tim_ddr/DDR_TOPOLOGY_1.txt
@@ -20,3 +20,6 @@ ddr_bus_width_index=2
 
 #4Gbits (512MB)
 ddr_mem_size_index=3
+
+#custom ddr setting
+preset_ddr_conf=ddr4-800-1cs-512m-issi.txt
diff --git a/ddr/tim_ddr/DDR_TOPOLOGY_5.txt b/ddr/tim_ddr/DDR_TOPOLOGY_5.txt
new file mode 100644
index 0000000..c4e3d45
--- /dev/null
+++ b/ddr/tim_ddr/DDR_TOPOLOGY_5.txt
@@ -0,0 +1,25 @@
+#
+# This file is the input for A3700 DDR porting tool,
+# each item is one parameter for DDR topology, which will be parsed by
+# DDR tool and generate DDR register list accordingly.
+# Supported Marvell boards:
+#       DDR4 1CS : ESPRESSObin (1GB)
+#
+
+#DDR4
+ddr_type=1
+
+#1CS
+ddr_cs_mask=1
+
+#DDR4_2400R
+ddr_speedbin_index=10
+
+#16BIT
+ddr_bus_width_index=2
+
+#8Gbits (1GB)
+ddr_mem_size_index=4
+
+#custom ddr setting
+preset_ddr_conf=ddr4-1cs-1g.txt
diff --git a/ddr/tim_ddr/DDR_TOPOLOGY_6.txt b/ddr/tim_ddr/DDR_TOPOLOGY_6.txt
new file mode 100644
index 0000000..6cd1464
--- /dev/null
+++ b/ddr/tim_ddr/DDR_TOPOLOGY_6.txt
@@ -0,0 +1,25 @@
+#
+# This file is the input for A3700 DDR porting tool,
+# each item is one parameter for DDR topology, which will be parsed by
+# DDR tool and generate DDR register list accordingly.
+# Supported Marvell boards:
+#       DDR4 2CS : ESPRESSObin (2GB)
+#
+
+#DDR4
+ddr_type=1
+
+#2CS
+ddr_cs_mask=3
+
+#DDR4_2400R
+ddr_speedbin_index=10
+
+#16BIT
+ddr_bus_width_index=2
+
+#8Gbits (1GB)
+ddr_mem_size_index=4
+
+#custom ddr setting
+preset_ddr_conf=ddr4-2cs-2g.txt
diff --git a/ddr/tim_ddr/DDR_TOPOLOGY_7.txt b/ddr/tim_ddr/DDR_TOPOLOGY_7.txt
new file mode 100644
index 0000000..df189af
--- /dev/null
+++ b/ddr/tim_ddr/DDR_TOPOLOGY_7.txt
@@ -0,0 +1,23 @@
+#
+# This file is the input for A3700 DDR porting tool,
+# each item is one parameter for DDR topology, which will be parsed by
+# DDR tool and generate DDR register list accordingly.
+# Supported Marvell boards:
+#       DDR3 2CS : DB-88F3720-DDR3-Modular (2GB)
+#
+
+#DDR3
+ddr_type=0
+
+#2CS
+ddr_cs_mask=3
+
+#DDR3_1600K
+ddr_speedbin_index=12
+
+#16BIT
+ddr_bus_width_index=2
+
+#8Gbits (1GB)
+ddr_mem_size_index=4
+
diff --git a/ddr/tim_ddr/DDR_TOPOLOGY_8.txt b/ddr/tim_ddr/DDR_TOPOLOGY_8.txt
new file mode 100644
index 0000000..3911e24
--- /dev/null
+++ b/ddr/tim_ddr/DDR_TOPOLOGY_8.txt
@@ -0,0 +1,25 @@
+#
+# This file is the input for A3700 DDR porting tool,
+# each item is one parameter for DDR topology, which will be parsed by
+# DDR tool and generate DDR register list accordingly.
+# Supported Marvell boards:
+#       DDR4 2CS : ESPRESSObin - ISSI-43QR16256A * 2 (1GB)
+#
+
+#DDR4
+ddr_type=1
+
+#2CS
+ddr_cs_mask=3
+
+#DDR4_2400R
+ddr_speedbin_index=10
+
+#16BIT
+ddr_bus_width_index=2
+
+#4Gbits (512M)
+ddr_mem_size_index=3
+
+#custom ddr setting
+preset_ddr_conf=ddr4-800-2cs-1g-issi.txt
diff --git a/ddr/tim_ddr/ddr4-1cs-1g.txt b/ddr/tim_ddr/ddr4-1cs-1g.txt
new file mode 100644
index 0000000..96c8a3d
--- /dev/null
+++ b/ddr/tim_ddr/ddr4-1cs-1g.txt
@@ -0,0 +1,179 @@
+; Set DDR4 to 800MHz
+; Pre-init
+WRITE: 0xC0014008 0x00404500
+WRITE: 0xC0002000 0x00010000
+WRITE: 0xC0002004 0x00000000
+; DDR MAC init
+WRITE: 0xC0000340 0x00000303
+WRITE: 0xC0000344 0x0200000A
+WRITE: 0xC0000310 0x00100000
+WRITE: 0xC0000304 0x00000400
+WRITE: 0xC0000308 0x00000000
+WRITE: 0xC0000044 0x00030200
+WRITE: 0xC00002C0 0x00006000
+WRITE: 0xC00002C4 0x00000030
+WRITE: 0xC0000058 0x0000143F
+WRITE: 0xC0000048 0x00000001
+WRITE: 0xC0000180 0x00010200
+WRITE: 0xC0000050 0x000001FF
+WRITE: 0xC000004C 0x00000000
+WRITE: 0xC0000054 0x00000480
+WRITE: 0xC0000300 0x00000B0C
+WRITE: 0xC0000380 0x00061A80
+WRITE: 0xC0000384 0x00027100
+WRITE: 0xC0000388 0x00000050
+WRITE: 0xC000038C 0x00000400
+WRITE: 0xC0000390 0x00800200
+WRITE: 0xC0000394 0x011803CF
+WRITE: 0xC0000398 0x01200300
+WRITE: 0xC000039C 0x00000808
+WRITE: 0xC00003A0 0x04040500
+WRITE: 0xC00003A4 0x00000002
+WRITE: 0xC00003A8 0x00001808
+WRITE: 0xC00003AC 0x1C250B1A
+WRITE: 0xC00003B0 0x0B0C060B
+WRITE: 0xC00003B4 0x05040602
+WRITE: 0xC00003B8 0x00000605
+WRITE: 0xC0000200 0x000E0001
+WRITE: 0xC0000204 0x00000000
+WRITE: 0xC0000220 0x05020635
+WRITE: 0xC0000400 0x400E0001
+WRITE: 0xC0000404 0x00000000
+WRITE: 0xC00003C0 0x00020205
+WRITE: 0xC00003C4 0x00000003
+WRITE: 0xC00003DC 0x00081239
+WRITE: 0xC00002C8 0x00000000
+WRITE: 0xC0000064 0x00000006
+; DDR PHY init
+WRITE: 0xC0001010 0x00100100
+WRITE: 0xC0001014 0x00080200
+WRITE: 0xC000101C 0x90118011
+WRITE: 0xC0001028 0x00000011
+WRITE: 0xC0001040 0x00000607
+WRITE: 0xC00010C0 0x51000000
+WRITE: 0xC0001050 0x15150000
+WRITE: 0xC0001054 0x20100000
+WRITE: 0xC0001074 0x15150000
+
+;Setp7: init read fifo pointer and OFF spec parameter
+WRITE: 0xC0001000 0x00004032
+WRITE: 0xC00003bc 0x02020404
+
+;Step8: phyinit_sequence_sync2(1, 3, 2, 0)
+WRITE: 0xC0001014 0x00080200
+OR_VAL: 0xC0001038 0x00000003
+WRITE: 0xC000103C 0x00000020
+WRITE: 0xC0001020 0x80000000
+WRITE: 0xC0001020 0x20000000
+WRITE: 0xC0001020 0x40000000
+DELAY: 0x0000000A
+WRITE: 0xC0001020 0x80000000
+DELAY: 0x0000000A
+
+;Step9: DDRPHY Driver/Receiver & DQS internal Pullup/Pulldown settings
+;WRITE: 0xC0001004 0xD0133449
+WRITE: 0xC0001004 0xD0677449
+WRITE: 0xC0001008 0xC770055A
+WRITE: 0xC000100C 0x5461DF77
+
+;Step10:Skip for DDR4
+
+;Step11: DDRPHY pads POWERDOWN disable
+WRITE: 0xC0001030 0x03800000
+WRITE: 0xC0001034 0x00000000
+WRITE: 0xC0001090 0x00000000
+WRITE: 0xC0001094 0x00000000
+
+;Step12: initC2Dofset DDR4
+WRITE: 0xC00010E0 0x00010001
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010002
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010004
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010008
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010010
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+
+;Step 13: Set DDRPHY read DAC default VREF/range value
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xFFCAFFFF
+OR_SM_VAL: SM0 0x00150000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xC0FFFFFF
+OR_SM_VAL: SM0 0x32000000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0x3FFFFFFF
+OR_SM_VAL: SM0 0x40000000
+STORE_SM_ADDR: SM0 0xC0001038
+DELAY: 0x00000001
+
+;Step 17: Set default value for DRAM DQ VREF
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x11004000
+LOAD_SM_ADDR: SM0 0xC000030C
+DELAY: 0x00000001
+AND_SM_VAL: SM0 0xFFC0FFFF
+OR_SM_VAL: SM0 0x250000
+STORE_SM_ADDR: SM0 0xC000030C
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+
+;Step18: Trigger DDR init for channel 0
+WRITE: 0xC0000020 0x11000001
+
+;Step19: Poll and wait for ddr init done
+WAIT_FOR_BIT_SET: 0xC0000008 0x00000001 0x00001000
+
+LOAD_SM_VAL: SM0 0
+
+LABEL: LP1
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+MOV_SM_SM: SM1 SM0
+LSHIFT_SM_VAL: SM1 0x10
+OR_SM_SM: SM2 SM1
+STORE_SM_ADDR: SM2 0xC000030C
+OR_VAL: 0xC0000028 0x11004000
+ADD_SM_VAL: SM0 0x1
+TEST_SM_AND_BRANCH: SM0 0x000000FF 0x00000032 < LP1
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+OR_VAL: 0xC0000028 0x11004000
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+OR_SM_VAL: SM2 0x001C0000
+STORE_SM_ADDR: SM2 0xC000030C
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
diff --git a/ddr/tim_ddr/ddr4-2cs-2g.txt b/ddr/tim_ddr/ddr4-2cs-2g.txt
new file mode 100644
index 0000000..3a0a0f8
--- /dev/null
+++ b/ddr/tim_ddr/ddr4-2cs-2g.txt
@@ -0,0 +1,214 @@
+; Set DDR4 to 800MHz
+; Pre-init
+WRITE: 0xC0014008 0x00404500
+WRITE: 0xC0002000 0x00010000
+WRITE: 0xC0002004 0x00000000
+; DDR MAC init
+WRITE: 0xC0000340 0x00000303
+WRITE: 0xC0000344 0x0200000A
+WRITE: 0xC0000310 0x00100000
+WRITE: 0xC0000314 0x00100000
+WRITE: 0xC0000304 0x00000400
+WRITE: 0xC0000308 0x00000000
+WRITE: 0xC0000044 0x00030200
+WRITE: 0xC00002C0 0x00006000
+WRITE: 0xC00002C4 0x00000030
+WRITE: 0xC0000058 0x0000143F
+WRITE: 0xC0000048 0x00000001
+WRITE: 0xC0000180 0x00010200
+WRITE: 0xC0000050 0x000001FF
+WRITE: 0xC000004C 0x00000000
+WRITE: 0xC0000054 0x00000480
+WRITE: 0xC0000300 0x00000B0C
+WRITE: 0xC0000380 0x00061A80
+WRITE: 0xC0000384 0x00027100
+WRITE: 0xC0000388 0x00000050
+WRITE: 0xC000038C 0x00000400
+WRITE: 0xC0000390 0x00800200
+WRITE: 0xC0000394 0x011803CF
+WRITE: 0xC0000398 0x01200300
+WRITE: 0xC000039C 0x00000808
+WRITE: 0xC00003A0 0x04040500
+WRITE: 0xC00003A4 0x00000002
+WRITE: 0xC00003A8 0x00001808
+WRITE: 0xC00003AC 0x1C250B1A
+WRITE: 0xC00003B0 0x0B0C060B
+WRITE: 0xC00003B4 0x05040602
+WRITE: 0xC00003B8 0x00000605
+WRITE: 0xC0000200 0x000E0001
+WRITE: 0xC0000204 0x00000000
+WRITE: 0xC0000220 0x05020635
+WRITE: 0xC0000208 0x400E0001
+WRITE: 0xC000020C 0x00000000
+WRITE: 0xC0000224 0x05020635
+WRITE: 0xC0000400 0x800E0001
+WRITE: 0xC0000404 0x00000000
+WRITE: 0xC0000408 0xC00E0001
+WRITE: 0xC000040C 0x00000000
+WRITE: 0xC00003C0 0x00020205
+WRITE: 0xC00003C4 0x00000003
+WRITE: 0xC00003DC 0x00081239
+WRITE: 0xC00002C8 0x00000000
+WRITE: 0xC0000064 0x00000006
+; DDR PHY init
+WRITE: 0xC0001010 0x00100100
+WRITE: 0xC0001014 0x00080200
+WRITE: 0xC000101C 0x90118011
+WRITE: 0xC0001028 0x00000011
+WRITE: 0xC0001040 0x00000607
+WRITE: 0xC00010C0 0x51000000
+WRITE: 0xC0001050 0x15150000
+WRITE: 0xC0001054 0x20100000
+WRITE: 0xC0001074 0x15150000
+
+;Setp7: init read fifo pointer and OFF spec parameter
+WRITE: 0xC0001000 0x00004032
+WRITE: 0xC00003bc 0x02020404
+
+;Step8: phyinit_sequence_sync2(1, 3, 2, 0)
+WRITE: 0xC0001014 0x00080200
+OR_VAL: 0xC0001038 0x00000003
+WRITE: 0xC000103C 0x00000020
+WRITE: 0xC0001020 0x80000000
+WRITE: 0xC0001020 0x20000000
+WRITE: 0xC0001020 0x40000000
+DELAY: 0x0000000A
+WRITE: 0xC0001020 0x80000000
+DELAY: 0x0000000A
+
+;Step9: DDRPHY Driver/Receiver & DQS internal Pullup/Pulldown settings
+;WRITE: 0xC0001004 0xD0133449
+WRITE: 0xC0001004 0xD0677449
+WRITE: 0xC0001008 0xC770055A
+WRITE: 0xC000100C 0x5461DF77
+
+;Step10:Skip for DDR4
+
+;Step11: DDRPHY pads POWERDOWN disable
+WRITE: 0xC0001030 0x03800000
+WRITE: 0xC0001034 0x00000000
+WRITE: 0xC0001090 0x00000000
+WRITE: 0xC0001094 0x00000000
+
+;Step12: initC2Dofset DDR4
+WRITE: 0xC00010E0 0x00010001
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010002
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010004
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010008
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010010
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+
+;for CS1
+WRITE: 0xC00010E0 0x00020001
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020002
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020004
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020008
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020010
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+
+;Step 13: Set DDRPHY read DAC default VREF/range value
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xFFCAFFFF
+OR_SM_VAL: SM0 0x00150000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xC0FFFFFF
+OR_SM_VAL: SM0 0x32000000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0x3FFFFFFF
+OR_SM_VAL: SM0 0x40000000
+STORE_SM_ADDR: SM0 0xC0001038
+DELAY: 0x00000001
+
+;Step 17: Set default value for DRAM DQ VREF
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x13004000
+LOAD_SM_ADDR: SM0 0xC000030C
+DELAY: 0x00000001
+AND_SM_VAL: SM0 0xFFC0FFFF
+OR_SM_VAL: SM0 0x250000
+STORE_SM_ADDR: SM0 0xC000030C
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+
+;Step18: Trigger DDR init for both CS
+WRITE: 0xC0000020 0x13000001
+
+;Step19: Poll and wait for ddr init done
+WAIT_FOR_BIT_SET: 0xC0000008 0x00000001 0x00001000
+WAIT_FOR_BIT_SET: 0xC0000008 0x00000010 0x00001000
+; DDR INIT DONE
+
+LOAD_SM_VAL: SM0 0
+
+LABEL: LP1
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+MOV_SM_SM: SM1 SM0
+LSHIFT_SM_VAL: SM1 0x10
+OR_SM_SM: SM2 SM1
+STORE_SM_ADDR: SM2 0xC000030C
+OR_VAL: 0xC0000028 0x13004000
+ADD_SM_VAL: SM0 0x1
+TEST_SM_AND_BRANCH: SM0 0x000000FF 0x00000032 < LP1
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+OR_VAL: 0xC0000028 0x13004000
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+OR_SM_VAL: SM2 0x00250000
+STORE_SM_ADDR: SM2 0xC000030C
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
diff --git a/ddr/tim_ddr/ddr4-800-1cs-512m-issi.txt b/ddr/tim_ddr/ddr4-800-1cs-512m-issi.txt
new file mode 100644
index 0000000..9256bc3
--- /dev/null
+++ b/ddr/tim_ddr/ddr4-800-1cs-512m-issi.txt
@@ -0,0 +1,179 @@
+; Set DDR4 to 800MHz
+; Pre-init
+WRITE: 0xC0014008 0x00404500
+WRITE: 0xC0002000 0x00010000
+WRITE: 0xC0002004 0x00000000
+; DDR MAC init
+WRITE: 0xC0000340 0x00000303
+WRITE: 0xC0000344 0x0200000A
+WRITE: 0xC0000310 0x00100000
+WRITE: 0xC0000304 0x00000400
+WRITE: 0xC0000308 0x00000000
+WRITE: 0xC0000044 0x00030200
+WRITE: 0xC00002C0 0x00006000
+WRITE: 0xC00002C4 0x00000030
+WRITE: 0xC0000058 0x0000143F
+WRITE: 0xC0000048 0x00000001
+WRITE: 0xC0000180 0x00010200
+WRITE: 0xC0000050 0x000001FF
+WRITE: 0xC000004C 0x00000000
+WRITE: 0xC0000054 0x00000480
+WRITE: 0xC0000300 0x00000B0C
+WRITE: 0xC0000380 0x00061A80
+WRITE: 0xC0000384 0x00027100
+WRITE: 0xC0000388 0x00000050
+WRITE: 0xC000038C 0x00000400
+WRITE: 0xC0000390 0x00800200
+WRITE: 0xC0000394 0x00D003CF
+WRITE: 0xC0000398 0x00D80300
+WRITE: 0xC000039C 0x00000808
+WRITE: 0xC00003A0 0x04040500
+WRITE: 0xC00003A4 0x00000002
+WRITE: 0xC00003A8 0x00001808
+WRITE: 0xC00003AC 0x1C250B1A
+WRITE: 0xC00003B0 0x0B0C060B
+WRITE: 0xC00003B4 0x05040602
+WRITE: 0xC00003B8 0x00000605
+WRITE: 0xC0000200 0x000D0001
+WRITE: 0xC0000204 0x00000000
+WRITE: 0xC0000220 0x05020535
+WRITE: 0xC0000400 0x200D0001
+WRITE: 0xC0000404 0x00000000
+WRITE: 0xC00003C0 0x00020205
+WRITE: 0xC00003C4 0x00000003
+WRITE: 0xC00003DC 0x00081239
+WRITE: 0xC00002C8 0x00000000
+WRITE: 0xC0000064 0x00000006
+; DDR PHY init
+WRITE: 0xC0001010 0x00100100
+WRITE: 0xC0001014 0x00080200
+WRITE: 0xC000101C 0x90118011
+WRITE: 0xC0001028 0x00000011
+WRITE: 0xC0001040 0x00000607
+WRITE: 0xC00010C0 0x51000000
+WRITE: 0xC0001050 0x15150000
+WRITE: 0xC0001054 0x20100000
+WRITE: 0xC0001074 0x15150000
+
+;Setp7: init read fifo pointer and OFF spec parameter
+WRITE: 0xC0001000 0x00004032
+WRITE: 0xC00003bc 0x02020404
+
+;Step8: phyinit_sequence_sync2(1, 3, 2, 0)
+WRITE: 0xC0001014 0x00080200
+OR_VAL: 0xC0001038 0x00000003
+WRITE: 0xC000103C 0x00000020
+WRITE: 0xC0001020 0x80000000
+WRITE: 0xC0001020 0x20000000
+WRITE: 0xC0001020 0x40000000
+DELAY: 0x0000000A
+WRITE: 0xC0001020 0x80000000
+DELAY: 0x0000000A
+
+;Step9: DDRPHY Driver/Receiver & DQS internal Pullup/Pulldown settings
+;WRITE: 0xC0001004 0xD0133449
+WRITE: 0xC0001004 0xD0677449
+WRITE: 0xC0001008 0xC770055A
+WRITE: 0xC000100C 0x5461DF77
+
+;Step10:Skip for DDR4
+
+;Step11: DDRPHY pads POWERDOWN disable
+WRITE: 0xC0001030 0x03800000
+WRITE: 0xC0001034 0x00000000
+WRITE: 0xC0001090 0x00000000
+WRITE: 0xC0001094 0x00000000
+
+;Step12: initC2Dofset DDR4
+WRITE: 0xC00010E0 0x00010001
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010002
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010004
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010008
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010010
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+
+;Step 13: Set DDRPHY read DAC default VREF/range value
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xFFCAFFFF
+OR_SM_VAL: SM0 0x00150000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xC0FFFFFF
+OR_SM_VAL: SM0 0x32000000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0x3FFFFFFF
+OR_SM_VAL: SM0 0x40000000
+STORE_SM_ADDR: SM0 0xC0001038
+DELAY: 0x00000001
+
+;Step 17: Set default value for DRAM DQ VREF
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x11004000
+LOAD_SM_ADDR: SM0 0xC000030C
+DELAY: 0x00000001
+AND_SM_VAL: SM0 0xFFC0FFFF
+OR_SM_VAL: SM0 0x250000
+STORE_SM_ADDR: SM0 0xC000030C
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+
+;Step18: Trigger DDR init for channel 0
+WRITE: 0xC0000020 0x11000001
+
+;Step19: Poll and wait for ddr init done
+WAIT_FOR_BIT_SET: 0xC0000008 0x00000001 0x00001000
+
+LOAD_SM_VAL: SM0 0
+
+LABEL: LP1
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+MOV_SM_SM: SM1 SM0
+LSHIFT_SM_VAL: SM1 0x10
+OR_SM_SM: SM2 SM1
+STORE_SM_ADDR: SM2 0xC000030C
+OR_VAL: 0xC0000028 0x11004000
+ADD_SM_VAL: SM0 0x1
+TEST_SM_AND_BRANCH: SM0 0x000000FF 0x00000032 < LP1
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+OR_VAL: 0xC0000028 0x11004000
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+OR_SM_VAL: SM2 0x001C0000
+STORE_SM_ADDR: SM2 0xC000030C
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x11004000
+DELAY: 0x00000001
diff --git a/ddr/tim_ddr/ddr4-800-2cs-1g-issi.txt b/ddr/tim_ddr/ddr4-800-2cs-1g-issi.txt
new file mode 100644
index 0000000..be906e5
--- /dev/null
+++ b/ddr/tim_ddr/ddr4-800-2cs-1g-issi.txt
@@ -0,0 +1,214 @@
+; Set DDR4 to 800MHz
+; Pre-init
+WRITE: 0xC0014008 0x00404500
+WRITE: 0xC0002000 0x00010000
+WRITE: 0xC0002004 0x00000000
+; DDR MAC init
+WRITE: 0xC0000340 0x00000303
+WRITE: 0xC0000344 0x0200000A
+WRITE: 0xC0000310 0x00100000
+WRITE: 0xC0000314 0x00100000
+WRITE: 0xC0000304 0x00000400
+WRITE: 0xC0000308 0x00000000
+WRITE: 0xC0000044 0x00030200
+WRITE: 0xC00002C0 0x00006000
+WRITE: 0xC00002C4 0x00000030
+WRITE: 0xC0000058 0x0000143F
+WRITE: 0xC0000048 0x00000001
+WRITE: 0xC0000180 0x00010200
+WRITE: 0xC0000050 0x000001FF
+WRITE: 0xC000004C 0x00000000
+WRITE: 0xC0000054 0x00000480
+WRITE: 0xC0000300 0x00000B0C
+WRITE: 0xC0000380 0x00061A80
+WRITE: 0xC0000384 0x00027100
+WRITE: 0xC0000388 0x00000050
+WRITE: 0xC000038C 0x00000400
+WRITE: 0xC0000390 0x00800200
+WRITE: 0xC0000394 0x00D003CF
+WRITE: 0xC0000398 0x00D80300
+WRITE: 0xC000039C 0x00000808
+WRITE: 0xC00003A0 0x04040500
+WRITE: 0xC00003A4 0x00000002
+WRITE: 0xC00003A8 0x00001808
+WRITE: 0xC00003AC 0x1C250B1A
+WRITE: 0xC00003B0 0x0B0C060B
+WRITE: 0xC00003B4 0x05040602
+WRITE: 0xC00003B8 0x00000605
+WRITE: 0xC0000200 0x000D0001
+WRITE: 0xC0000204 0x00000000
+WRITE: 0xC0000220 0x05020535
+WRITE: 0xC0000208 0x200D0001
+WRITE: 0xC000020C 0x00000000
+WRITE: 0xC0000224 0x05020535
+WRITE: 0xC0000400 0x400D0001
+WRITE: 0xC0000404 0x00000000
+WRITE: 0xC0000408 0x600D0001
+WRITE: 0xC000040C 0x00000000
+WRITE: 0xC00003C0 0x00020205
+WRITE: 0xC00003C4 0x00000003
+WRITE: 0xC00003DC 0x00081239
+WRITE: 0xC00002C8 0x00000000
+WRITE: 0xC0000064 0x00000006
+; DDR PHY init
+WRITE: 0xC0001010 0x00100100
+WRITE: 0xC0001014 0x00080200
+WRITE: 0xC000101C 0x90118011
+WRITE: 0xC0001028 0x00000011
+WRITE: 0xC0001040 0x00000607
+WRITE: 0xC00010C0 0x51000000
+WRITE: 0xC0001050 0x15150000
+WRITE: 0xC0001054 0x20100000
+WRITE: 0xC0001074 0x15150000
+
+;Setp7: init read fifo pointer and OFF spec parameter
+WRITE: 0xC0001000 0x00004032
+WRITE: 0xC00003bc 0x02020404
+
+;Step8: phyinit_sequence_sync2(1, 3, 2, 0)
+WRITE: 0xC0001014 0x00080200
+OR_VAL: 0xC0001038 0x00000003
+WRITE: 0xC000103C 0x00000020
+WRITE: 0xC0001020 0x80000000
+WRITE: 0xC0001020 0x20000000
+WRITE: 0xC0001020 0x40000000
+DELAY: 0x0000000A
+WRITE: 0xC0001020 0x80000000
+DELAY: 0x0000000A
+
+;Step9: DDRPHY Driver/Receiver & DQS internal Pullup/Pulldown settings
+;WRITE: 0xC0001004 0xD0133449
+WRITE: 0xC0001004 0xD0677449
+WRITE: 0xC0001008 0xC770055A
+WRITE: 0xC000100C 0x5461DF77
+
+;Step10:Skip for DDR4
+
+;Step11: DDRPHY pads POWERDOWN disable
+WRITE: 0xC0001030 0x03800000
+WRITE: 0xC0001034 0x00000000
+WRITE: 0xC0001090 0x00000000
+WRITE: 0xC0001094 0x00000000
+
+;Step12: initC2Dofset DDR4
+WRITE: 0xC00010E0 0x00010001
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010002
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010004
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010008
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00010010
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+
+;for CS1
+WRITE: 0xC00010E0 0x00020001
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020002
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020004
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00300C03
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020008
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+WRITE: 0xC00010E0 0x00020010
+WRITE: 0xC00010D0 0x000C0300
+WRITE: 0xC00010D4 0x00300C03
+WRITE: 0xC00010D8 0x00339CE7
+WRITE: 0xC00010DC 0x00300C03
+
+;Step 13: Set DDRPHY read DAC default VREF/range value
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xFFCAFFFF
+OR_SM_VAL: SM0 0x00150000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0xC0FFFFFF
+OR_SM_VAL: SM0 0x32000000
+STORE_SM_ADDR: SM0 0xC0001038
+LOAD_SM_ADDR: SM0 0xC0001038
+AND_SM_VAL: SM0 0x3FFFFFFF
+OR_SM_VAL: SM0 0x40000000
+STORE_SM_ADDR: SM0 0xC0001038
+DELAY: 0x00000001
+
+;Step 17: Set default value for DRAM DQ VREF
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x13004000
+LOAD_SM_ADDR: SM0 0xC000030C
+DELAY: 0x00000001
+AND_SM_VAL: SM0 0xFFC0FFFF
+OR_SM_VAL: SM0 0x250000
+STORE_SM_ADDR: SM0 0xC000030C
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+
+;Step18: Trigger DDR init for both CS
+WRITE: 0xC0000020 0x13000001
+
+;Step19: Poll and wait for ddr init done
+WAIT_FOR_BIT_SET: 0xC0000008 0x00000001 0x00001000
+WAIT_FOR_BIT_SET: 0xC0000008 0x00000010 0x00001000
+; DDR INIT DONE
+
+LOAD_SM_VAL: SM0 0
+
+LABEL: LP1
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+MOV_SM_SM: SM1 SM0
+LSHIFT_SM_VAL: SM1 0x10
+OR_SM_SM: SM2 SM1
+STORE_SM_ADDR: SM2 0xC000030C
+OR_VAL: 0xC0000028 0x13004000
+ADD_SM_VAL: SM0 0x1
+TEST_SM_AND_BRANCH: SM0 0x000000FF 0x00000032 < LP1
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+OR_VAL: 0xC0000028 0x13004000
+OR_VAL: 0xC0000308 0x00000010
+OR_VAL: 0xC000030C 0x00800000
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+
+LOAD_SM_ADDR: SM2 0xC000030C
+AND_SM_VAL: SM2 0xFFC0FFFF
+OR_SM_VAL: SM2 0x00250000
+STORE_SM_ADDR: SM2 0xC000030C
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
+
+AND_VAL: 0xC0000308 0xFFFFFFEF
+WRITE: 0xC0000028 0x13004000
+DELAY: 0x00000001
diff --git a/script/buildtim.sh b/script/buildtim.sh
index 62d2753..8ecd3ba 100755
--- a/script/buildtim.sh
+++ b/script/buildtim.sh
@@ -237,7 +237,7 @@ UART)
 esac
 
 case "$DDRTOPOLOGY" in
-CUST | [0-4])
+CUST | [0-8])
 	DDRTOPFILE=$CLOCKSPATH/DDR_TOPOLOGY_$DDRTOPOLOGY.$FILEEXT
 	;;
 *)
-- 
1.9.1

